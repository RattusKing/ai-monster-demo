<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Monster Chat Demo</title>
  <style>
    /* Galaxy background */
    body {
      margin: 0;
      height: 100vh;
      background: url('https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?auto=format&fit=crop&w=1470&q=80') no-repeat center center fixed;
      background-size: cover;
      font-family: Arial, sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      padding: 20px;
      box-sizing: border-box;
      flex-direction: column;
    }

    /* Container holds monster and chat */
    #container {
      background: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      padding: 20px;
      box-sizing: border-box;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }

    /* Monster image */
    #monster-image {
      width: 160px;
      max-width: 80vw;
      user-select: none;
      pointer-events: none;
      margin-bottom: 15px;
      image-rendering: pixelated;
    }

    /* Chat messages box */
    #chat-box {
      height: 250px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.85);
      border-radius: 10px;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 15px;
      box-shadow: inset 0 0 5px #00ff00aa;
      width: 100%;
      scroll-behavior: smooth;
    }

    /* Individual messages */
    #chat-box div {
      margin-bottom: 10px;
    }

    /* Input area */
    #user-input-container {
      display: flex;
      gap: 10px;
      width: 100%;
    }

    #user-input {
      flex-grow: 1;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      outline: none;
      background: #111;
      color: white;
    }

    #send-button {
      padding: 10px 20px;
      font-size: 16px;
      background: #39a839;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    #send-button:hover {
      background: #2f842f;
    }
  </style>
</head>
<body>
  <div id="container">
    <img id="monster-image" src="https://i.imgur.com/6XQYbqH.png" alt="Cute Monster" />
    <div id="chat-box"></div>
    <div id="user-input-container">
      <input id="user-input" type="text" placeholder="Type your message..." autocomplete="off" />
      <button id="send-button">Send</button>
    </div>
  </div>

  <script>
  console.log("monster.js loaded with learning");

  const chatBox = document.getElementById('chat-box');
  const userInput = document.getElementById('user-input');
  const sendButton = document.getElementById('send-button');

  // Load memory from sessionStorage or start fresh
  let learnedResponses = JSON.parse(sessionStorage.getItem('learnedResponses') || '{}');

  // Flag to track if we are expecting a learning reply from the user
  let expectingTeaching = false;
  let lastUserQuestion = '';

  const defaultReplies = [
    "I'm lurking in the shadows.",
    "That's me! What do you want to know?",
    "Hmm... tell me more!",
    "I love to chat with you!",
    "I don't quite get that yet.",
    "Can you say that again differently?",
    "You’re interesting!",
    "Let’s talk about something fun!",
    "What else would you like to know?",
    "I'm learning every day."
  ];

  function addMessage(sender, text) {
    const msgDiv = document.createElement('div');
    msgDiv.textContent = `${sender}: ${text}`;
    msgDiv.style.color = sender === 'Monster' ? '#aaffaa' : '#eee';
    chatBox.appendChild(msgDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function saveMemory() {
    sessionStorage.setItem('learnedResponses', JSON.stringify(learnedResponses));
  }

  // Greet on load
  addMessage('Monster', "Hello, I'm your AI Monster. Talk to me!");

  sendButton.addEventListener('click', () => {
    const text = userInput.value.trim();
    if (!text) return;
    addMessage('You', text);
    userInput.value = '';

    if (expectingTeaching) {
      // We expect user to teach a reply
      learnedResponses[lastUserQuestion] = text;
      saveMemory();
      addMessage('Monster', `Got it! I'll remember that when you say "${lastUserQuestion}" again.`);
      expectingTeaching = false;
      lastUserQuestion = '';
      return;
    }

    // Check if monster already knows a reply for this exact message
    const lowerText = text.toLowerCase();

    if (learnedResponses[lowerText]) {
      addMessage('Monster', learnedResponses[lowerText]);
      return;
    }

    // Simple keyword replies
    if (lowerText.includes('hello') || lowerText.includes('hi')) {
      addMessage('Monster', "Hi there! Nice to meet you.");
    } else if (lowerText.includes('how are you')) {
      addMessage('Monster', "I'm doing great, thanks for asking!");
    } else if (lowerText.includes('monster')) {
      addMessage('Monster', "Yep, that's me! Your friendly AI Monster.");
    } else if (lowerText.includes('help')) {
      addMessage('Monster', "How can I assist you today?");
    } else {
      // Unknown input - ask user to teach
      addMessage('Monster', "I don't know how to respond to that yet. How should I reply?");
      expectingTeaching = true;
      lastUserQuestion = lowerText;
    }
  });

  userInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      sendButton.click();
    }
  });
</script>
